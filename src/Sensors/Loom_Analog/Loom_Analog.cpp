#include "../../Loom_Analog.h"


//////////////////////////////////////////////////////////////////////////////////////////////////////
void Loom_Analog::measure(){

    // Clear the map before adding new data
    pinToData.clear();

    // Read the data from the given analog pin
    for(int i = 0; i < analogPins.size(); i++){
        pinToData.insert(std::pair<String, float>(pin_number_to_name(analogPins[i]), digitalRead(analogPins[i])));
    }

    // Pull the battery voltage and add it to the top of 
    pinToData.insert(std::pair<String, float>("Vbat", get_battery_voltage()));
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
void Loom_Analog::package(){
    for ( const auto &myPair : pinToData ) {
        manInst->getDocument()[getModuleName()][myPair.first] = pinToData[myPair.first];
    }
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
float Loom_Analog::get_battery_voltage(){
    float pin_reading = analogRead(A7);
    pin_reading *= 2;
    pin_reading *= 3.3;
    pin_reading /= 1024;
    return pin_reading;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
String Loom_Analog::pin_number_to_name(int pin){
    return "A" + String((pin - 14));
}
//////////////////////////////////////////////////////////////////////////////////////////////////////