#include "Loom_ADS1232.h"

//////////////////////////////////////////////////////////////////////////////////////////////////////
Loom_ADS1232::Loom_ADS1232(Manager& man, int num_samples, long offset, float scale) : Module("ADS1232"), manInst(&man), inst(ADS1232_Lib(A2, A1, A0)) {
    this->offset = offset;
    this->scale = scale;
    this->num_samples = num_samples;

    manInst->registerModule(this);
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
void Loom_ADS1232::initialize(){
    calibrate();
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
void Loom_ADS1232::measure(){
    weight = inst.units_read(num_samples);
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
void Loom_ADS1232::package(){
    JsonObject json = manInst->get_data_object(getModuleName());
    json["weight"] = weight;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
void Loom_ADS1232::calibrate(){
    inst.OFFSET = this->offset;
    inst.SCALE = this->scale;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////