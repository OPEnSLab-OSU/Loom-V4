#include "Loom_BatchSD.h"

//////////////////////////////////////////////////////////////////////////////////////////////////////
Loom_BatchSD::Loom_BatchSD(Loom_Hypnos& hypnos, int batchSize) : batchSize(batchSize){
    sdMan = hypnos.getSDManager();
    sdMan->setBatchSize(batchSize);
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
bool Loom_BatchSD::shouldPublish(){
    return (sdMan->getCurrentBatch() == batchSize);
}
//////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////
std::vector<String> Loom_BatchSD::getBatch(){
    std::vector<String> batch;
    String fileOutput = sdMan->readFile(sdMan->getBatchFilename());
    String currentLine = "";

    // Convert each batch into a string and push it into the vector of batches
    for(int i = 0; i < fileOutput.length(); i++){
        if(fileOutput[i] == '\n'){
            batch.push_back(currentLine);
            currentLine = "";
        }
        else{
            currentLine += fileOutput[i];
        }
    }

    return batch;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////